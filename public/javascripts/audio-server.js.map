{"version":3,"sources":["webpack:///webpack/bootstrap 86c307f05d0ee15da9db?872f","webpack:///./src/AudioServer.ts","webpack:///../vector-screencast-audioserver/src/AudioRecording.ts","webpack:///external \"ws\"","webpack:///external \"wav\"","webpack:///external \"node-uuid\"","webpack:///external \"colors\"","webpack:///../vector-screencast-audioserver/src/AudioConvertor.ts"],"names":[],"mappings":"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","file":"javascripts/audio-server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 86c307f05d0ee15da9db\n **/","var AudioRecording_1 = require('../../vector-screencast-audioserver/src/AudioRecording');\n// init the server\nvar server = new AudioRecording_1.default({\n    hostName: 'localhost',\n    port: 4000,\n    path: '/',\n    outputDir: './public/recordings',\n    formats: ['mp3'],\n    deleteWav: true\n});\n// start listening for clients\nserver.Start();\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/ts-loader?sourceMap!./src/AudioServer.ts\n **/","/// <reference path='../typings/node/node.d.ts' />\n/// <reference path='./node-libs.d.ts' />\nvar ws_1 = require('ws');\nvar wav_1 = require('wav');\nvar fs = require('fs');\nvar node_uuid_1 = require('node-uuid');\nvar colors_1 = require('colors');\nvar AudioConvertor_1 = require('./AudioConvertor');\nvar Server = (function () {\n    function Server(cfg) {\n        this.cfg = cfg;\n        // default settings if needed\n        if (!cfg.port)\n            cfg.port = 45678;\n        if (!cfg.outputDir)\n            cfg.outputDir = __dirname;\n        if (!cfg.formats)\n            cfg.formats = ['mp3', 'ogg'];\n        this.config = cfg;\n    }\n    Server.prototype.Start = function () {\n        var _this = this;\n        // init binary server\n        this.server = new ws_1.WebSocketServer({\n            port: this.config.port\n        });\n        if (this.server) {\n            console.log(colors_1.colors.yellow(\"Audio recorder is running and listening on port \" + this.config.port));\n        }\n        else {\n            console.log(colors_1.colors.red('Audio recorder could not be started.'));\n        }\n        this.server.on('connection', function (socket) { return _this.HandleClient(socket); });\n        this.server.on('error', function (error) { return console.log(\"ERROR: \" + error); });\n    };\n    Server.prototype.HandleClient = function (socket) {\n        var _this = this;\n        try {\n            // serve the client\n            console.log(colors_1.colors.blue('Handling new client'));\n            var fileWriter = null;\n            var $this = this;\n            // generate random unique file\n            var name = this.GetTempFileName(this.cfg.outputDir, '.wav');\n            var recordingEndedProperly = false;\n            socket.on('message', function (message, flags) {\n                if (recordingEndedProperly === false) {\n                    if (!flags.binary) {\n                        var msg = JSON.parse(message);\n                        if (!!msg && msg.type === 'start') {\n                            fileWriter = _this.InitRecording(name, msg);\n                        }\n                        else if (!!msg && msg.type === 'end') {\n                            recordingEndedProperly = true;\n                            _this.FinishRecording(_this.cfg.hostName, name, fileWriter, socket, _this.cfg.deleteWav);\n                        }\n                        else {\n                            // error - unsupported message\n                            console.log(colors_1.colors.red('Unsupported message'), message);\n                        }\n                    }\n                    else {\n                        if (!!fileWriter) {\n                            fileWriter.file.write(message);\n                        }\n                        else {\n                            // error - not initialised properly\n                            console.log(colors_1.colors.red('Binary data can\\'t be accepted - initialisation wasn\\'t done properly.'));\n                            socket.close();\n                        }\n                    }\n                }\n            });\n            // stream was closed\n            socket.on('close', function () {\n                console.log('stream closed');\n                if (!recordingEndedProperly) {\n                    if (fileWriter !== null) {\n                        fileWriter.end();\n                        fs.unlink(name, function (err) {\n                            if (err) {\n                                console.log(colors_1.colors.red(\"Can't delete tmp wav file \" + name));\n                                return;\n                            }\n                            console.log(colors_1.colors.yellow(\"Tmp file \" + name + \" was deleted as stream was closed and not ended properly\"));\n                        });\n                    }\n                }\n            });\n        }\n        catch (e) {\n            console.log(colors_1.colors.red('A fatal error occured while serving a client. Recording session was aborted.'), e);\n        }\n    };\n    Server.prototype.InitRecording = function (name, msg) {\n        console.log(colors_1.colors.gray('initialising streaming into ') + name);\n        // save all incoming data (INT16 PCM) to the Wav file\n        var fileWriter = new wav_1.Wav.FileWriter(name, {\n            channels: msg.channels || 1,\n            sampleRate: msg.sampleRate || 48000,\n            bitDepth: msg.bitDepth || 16\n        });\n        return fileWriter;\n    };\n    Server.prototype.FinishRecording = function (hostName, name, fileWriter, socket, deleteWav) {\n        // write the Wav into the file\n        fileWriter.end();\n        fileWriter = null;\n        this.TryConvertTo(name, deleteWav, function (results) {\n            // inform the client about the result\n            if (!!socket) {\n                for (var i = 0; i < results.length; i++) {\n                    results[i].url = hostName + results[i].url;\n                }\n                socket.send(JSON.stringify({\n                    error: false,\n                    files: results\n                }));\n            }\n            else {\n                console.log(colors_1.colors.red('Can\\'t report the result - socket is already closed'));\n            }\n            // now close the socket\n            socket.close();\n        });\n    };\n    Server.prototype.GetTempFileName = function (dir, ext) {\n        dir = dir || './';\n        ext = ext || '';\n        // this will NEVER colide, for sure\n        // see http://en.wikipedia.org/wiki/Universally_unique_identifier\n        return dir + \"/\" + node_uuid_1.uuid.v4() + ext;\n    };\n    Server.prototype.TryConvertTo = function (input, deleteWav, success) {\n        AudioConvertor_1.default({\n            input: input,\n            formats: this.cfg.formats,\n            quality: 64,\n            publicRoot: './public',\n            outputDir: '/recordings',\n            channels: 1,\n            debug: false,\n            success: function (files) {\n                var resultFileNames = [{\n                        url: input,\n                        type: 'audio/wav'\n                    }];\n                if (files.length > 0) {\n                    if (deleteWav) {\n                        // I don't need the Wav any more\n                        fs.unlink(input, function (err) {\n                            if (err) {\n                                console.log(colors_1.colors.red(\"Can't delete tmp wav file \" + input));\n                                return;\n                            }\n                            console.log(colors_1.colors.green(\"Tmp file \" + input + \" was deleted\"));\n                        });\n                        resultFileNames = files;\n                    }\n                    else {\n                        resultFileNames = resultFileNames.concat(files);\n                    }\n                }\n                if (success) {\n                    success(resultFileNames);\n                }\n            },\n            error: function () {\n                console.log(colors_1.colors.red(\"Error while converting the result from wav to \" + this.cfg.formats));\n            }\n        });\n    };\n    return Server;\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = Server;\n//} \n\n\n\n/** WEBPACK FOOTER **\n ** ./~/ts-loader?sourceMap!../vector-screencast-audioserver/src/AudioRecording.ts\n **/","module.exports = require(\"ws\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"ws\"\n ** module id = 8\n ** module chunks = 1\n **/","module.exports = require(\"wav\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"wav\"\n ** module id = 9\n ** module chunks = 1\n **/","module.exports = require(\"node-uuid\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-uuid\"\n ** module id = 10\n ** module chunks = 1\n **/","module.exports = require(\"colors\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"colors\"\n ** module id = 11\n ** module chunks = 1\n **/","/// <refenrece path=\"../typings/tsd.d.ts\" />\nimport { spawn } from 'child_process';\nimport { colors } from 'colors';\nexport default function convert(cfg) {\n    if (cfg === undefined) {\n        console.log(colors.red(\"Audio Converted Error - No information passed.\"));\n        return false;\n    }\n    if (!cfg.hasOwnProperty(\"input\")) {\n        console.log(\"Audio Converter Error - No input filename specified.\");\n        return false;\n    }\n    var name = cfg.input.substr(cfg.input.lastIndexOf(\"/\") + 1);\n    name = name.substr(0, name.lastIndexOf(\".\"));\n    var outputDir = cfg.publicRoot + cfg.outputDir || \"./\";\n    var formats = cfg.formats || [\"mp3\"];\n    var done = 0;\n    var successful = [];\n    var debug = cfg.debug === undefined ? true : cfg.debug;\n    var overrideArg = (cfg.hasOwnProperty(\"override\") && cfg.override !== undefined) ? (cfg.override === true ? \"-y\" : \"-n\")\n        : \"-y\";\n    for (var i in formats) {\n        var ext = formats[i];\n        convertTo(cfg, outputDir + \"/\" + name, ext, overrideArg, debug, (ext) => {\n            successful.push({\n                url: `${cfg.outputDir}/${name}.${ext}`,\n                type: `audio/${ext}`\n            });\n            if (++done === formats.length) {\n                if (cfg.hasOwnProperty(\"success\")) {\n                    cfg.success(successful);\n                }\n            }\n        }, (ext) => {\n            if (++done === formats.length) {\n                if (cfg.hasOwnProperty(\"success\")) {\n                    cfg.success(successful);\n                }\n            }\n        });\n    }\n}\nfunction convertTo(cfg, name, ext, overrideArg, debug, success, error) {\n    var output = name + \".\" + ext;\n    console.log(colors.gray(`Trying to convert ${cfg.input} to ${output}.`));\n    var ffmpeg = spawn(\"ffmpeg\", [\n        \"-i\", cfg.input.toString(),\n        \"-ac\", cfg.channels.toString() || \"1\",\n        \"-ab\", cfg.quality.toString() || \"64\",\n        \"-loglevel\", debug ? \"verbose\" : \"quiet\",\n        overrideArg,\n        output\n    ]);\n    ffmpeg.on(\"exit\", (code) => {\n        if (code === 0) {\n            console.log(colors.gray(`[${colors.green(\"OK\")}] ${ext}`));\n            success(ext);\n        }\n        else {\n            console.log(colors.gray(`[${colors.red(\"XX\")}] ${ext}`));\n            error(ext);\n        }\n    });\n    ffmpeg.stderr.on(\"data\", (err) => {\n        console.log(\"FFmpeg err: %s\", err);\n    });\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ../vector-screencast-audioserver/~/ts-loader?sourceMap!../vector-screencast-audioserver/src/AudioConvertor.ts\n **/"],"sourceRoot":""}